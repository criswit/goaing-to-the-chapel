---
title: Research Session
query: "16"
date: 9/11/2025
time: 10:53:51 AM
timestamp: 2025-09-11T17:53:51.077Z
exchanges: 1
---

# Research Session

## Initial Query

**Question:** 16

**Response:**

# JWT Authorization Re-enablement for Admin Dashboard Security

Based on your project context, Task 16 involves restoring JWT-based authentication to your wedding RSVP admin dashboard API endpoints. This is a critical security task that needs careful implementation to maintain proper access control while ensuring the system remains functional.

## Current Architecture Analysis

Your admin API uses a TokenAuthorizer pattern with API Gateway, which is the standard approach for serverless JWT authentication in AWS. The authorization flow involves:

1. **Authentication Lambda** (`verify-admin.ts`) - Validates JWT tokens and returns IAM policy
2. **TokenAuthorizer** - API Gateway authorizer that calls the authentication function
3. **Protected Endpoints** - Admin API routes under `/admin/protected/*` that require valid tokens

The current disabled state with debugging comments suggests this was temporarily removed during development troubleshooting, which is common when dealing with CORS and authentication interactions.

## Implementation Strategy

### Step 1: TokenAuthorizer Re-enablement
The commented-out TokenAuthorizer creation (lines 120-125 in `admin-api.ts`) should be restored carefully. Ensure the `authorizerFunction` reference points to your existing `verify-admin.ts` Lambda handler. The authorizer should be configured with:
- **Type**: `TOKEN`
- **Identity Source**: `method.request.header.Authorization`
- **TTL**: Appropriate caching duration (300-900 seconds recommended)

### Step 2: Endpoint Protection Restoration
When re-enabling the `authorizer` property on protected endpoints, pay special attention to CORS handling. Your wedding RSVP system likely serves requests from `https://wedding.himnher.dev`, so ensure:
- Preflight OPTIONS requests bypass authorization
- 401 responses include proper CORS headers
- Token validation errors return structured JSON responses

### Step 3: Integration Testing Approach
Given your existing infrastructure with DynamoDB tables (`WeddingAdmins`, `wedding-rsvp-production`) and the complex data model, testing should cover:

```javascript
// Test sequence for JWT re-enablement
1. Unauthenticated access → 401 with CORS headers
2. Invalid token → 401 with proper error structure  
3. Expired token → 401 with refresh guidance
4. Valid token → 200 with expected admin data
```

## Security Considerations Specific to Wedding RSVP Systems

### Token Management
Wedding admin dashboards often have extended sessions since administrators may spend considerable time managing guest lists and RSVPs. Consider implementing:
- **Refresh token rotation** for sessions longer than typical web apps
- **Role-based access** (ADMIN vs SUPER_ADMIN) as indicated in your `WeddingAdmins` table schema
- **Session invalidation** for sensitive operations like bulk guest imports

### CORS and Frontend Integration
Your frontend at `wedding.himnher.dev` needs to handle authentication state properly. Ensure your React admin components:
- Store JWT tokens securely (httpOnly cookies preferred over localStorage)
- Handle 401 responses by redirecting to `/admin/login`
- Include Authorization headers in all protected API calls

## Debugging and Monitoring

### CloudWatch Integration
Once re-enabled, monitor these metrics:
- **Authorization Lambda duration** - Should be <100ms for token validation
- **Token validation failures** - High rates may indicate attack attempts
- **CORS preflight success rates** - Frontend integration health indicator

### Common Issues Prevention
Based on similar serverless admin systems:
- **Clock skew**: Ensure JWT `iat` and `exp` times account for minor time differences
- **Case sensitivity**: HTTP header handling in Lambda authorizers is case-sensitive
- **Caching behavior**: API Gateway caches authorizer responses, so token revocation may have delays

## Testing Strategy Enhancement

Beyond the basic authentication flow testing mentioned in your task description, consider:

### Load Testing
Wedding websites often experience traffic spikes near RSVP deadlines. Test the JWT authorizer performance under load, especially since your system handles potentially hundreds of guests with complex party structures and dietary restrictions.

### Cross-browser Compatibility
Admin users may access the dashboard from various devices and browsers. Test JWT cookie handling and Authorization header transmission across different browsers, particularly on mobile devices where administrators might need to make quick updates.

This JWT re-enablement is particularly important for your wedding RSVP system since it protects sensitive guest data including email addresses, phone numbers, dietary restrictions, and RSVP responses that couples consider private information.


---

*Generated by Task Master Research Command*  
*Timestamp: 2025-09-11T17:53:51.077Z*
